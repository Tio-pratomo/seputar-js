---
sidebar_position: 6
---

# Optimasi dan Lingkungan (Environment)

Kebutuhan saat _development_ (pengembangan) dan _production_ (rilis ke publik) sangat berbeda.

- **Development:** Kita butuh build yang cepat, _source maps_ untuk debugging, dan _hot reload_.
- **Production:** Kita butuh ukuran file sekecil mungkin, kode yang teroptimasi, dan performa maksimal.

Oleh karena itu, **_praktik terbaiknya adalah memisahkan konfigurasi Webpack_**.

## Memisahkan Konfigurasi

Kita akan membuat tiga file konfigurasi:

- `webpack.common.js`: Berisi konfigurasi umum untuk kedua lingkungan.
- `webpack.dev.js`: Konfigurasi khusus untuk _development_.
- `webpack.prod.js`: Konfigurasi khusus untuk _production_.

Untuk menggabungkan file-file ini, kita butuh `webpack-merge`.

```bash
npm install --save-dev webpack-merge
```

**webpack.common.js**

Pindahkan semua konfigurasi yang sudah ada ke sini, kecuali `mode`, `output`, dan hal spesifik lainnya

```javascript title="webpack.common.js"
const HtmlWebpackPlugin = require("html-webpack-plugin");
const path = require("path");

module.exports = {
  entry: "./src/index.js",
  module: {
    /* ... rules ... */
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: "./src/template.html",
      filename: "index.html",
    }),
  ],
};
```

**webpack.dev.js**

```javascript
const { merge } = require("webpack-merge");
const common = require("./webpack.common.js");

module.exports = merge(common, {
  mode: "development",
  output: {
    filename: "bundle.js",
    // ...
  },
  // ... konfigurasi dev lainnya
});
```

**webpack.prod.js**

```javascript
const { merge } = require("webpack-merge");
const common = require("./webpack.common.js");

module.exports = merge(common, {
  mode: "production",
  output: {
    filename: "bundle.[contenthash].js",
    clean: true,
    // ...
  },
  // ... konfigurasi prod lainnya
});
```

## webpack-dev-server

Ini adalah server pengembangan yang menyediakan _live reload_ atau _hot reload_, untuk mempercepat proses development.

**Langkah 1: Install**

```bash
npm install --save-dev webpack-dev-server
```

**Langkah 2: Konfigurasi di `webpack.dev.js`**

```javascript
// webpack.dev.js
module.exports = merge(common, {
  mode: "development",
  devServer: {
    static: "./dist", // Folder yang akan di-serve
    compress: true,
    port: 9000,
    hot: true, // Aktifkan Hot Module Replacement
  },
  // ...
});
```

## Update `package.json` Scripts

```json
"scripts": {
  "start": "webpack serve --config webpack.dev.js",
  "build": "webpack --config webpack.prod.js"
}
```

- `npm start`: Menjalankan server pengembangan.
- `npm run build`: Membuat _bundle_ untuk produksi.

## Minifikasi (Minimizer)

Saat `mode: 'production'`, Webpack otomatis akan meminifikasi JavaScript Anda. Namun, untuk CSS, kita perlu plugin tambahan.

**CssMinimizerWebpackPlugin**

```bash
npm install --save-dev css-minimizer-webpack-plugin
```

Tambahkan ke `webpack.prod.js`:

```javascript title="webpack.prod.js"
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");

module.exports = merge(common, {
  // ...
  optimization: {
    minimizer: [
      `...`, // Ini akan menjaga minimizer default (untuk JS)
      new CssMinimizerPlugin(),
    ],
  },
});
```
